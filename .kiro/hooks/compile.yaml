name: legacy-auto-compile
description: "Automatically compiles legacy code (COBOL, FORTRAN, PASCAL, BASIC) when files are saved"
trigger:
  type: file_save
  pattern: "legacy/**/*.{cbl,f,pas,bas}"
action:
  type: command
  command: |
    bash -c '
    FILE="$KIRO_FILE_PATH"
    BASENAME="${FILE%.*}"
    
    echo "ğŸ”® INITIATING COMPILATION SEQUENCE FOR: $FILE"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    
    if [[ "$FILE" == *.cbl ]]; then
      echo "ğŸ“¼ LOADING COBOL COMPILER (GnuCOBOL)..."
      cobc -x -o "$BASENAME" "$FILE" 2>&1
      if [ $? -eq 0 ]; then
        echo "âœ… COBOL COMPILATION SUCCESSFUL"
        echo "ğŸ‘» Ancient Spirit Rebound to Binary: $(basename $BASENAME)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 0
      else
        echo "âŒ COBOL COMPILATION FAILED"
        echo "ğŸ› MOTH DETECTED IN COBOL PUNCH CARDS"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 1
      fi
      
    elif [[ "$FILE" == *.f ]]; then
      echo "ğŸ“¼ LOADING FORTRAN COMPILER (GNU Fortran)..."
      gfortran -o "$BASENAME" "$FILE" 2>&1
      if [ $? -eq 0 ]; then
        echo "âœ… FORTRAN COMPILATION SUCCESSFUL"
        echo "ğŸ‘» Ancient Spirit Rebound to Binary: $(basename $BASENAME)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 0
      else
        echo "âŒ FORTRAN COMPILATION FAILED"
        echo "ğŸ› MOTH DETECTED IN FORTRAN PUNCH CARDS"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 1
      fi
      
    elif [[ "$FILE" == *.pas ]]; then
      echo "ğŸ“¼ LOADING PASCAL COMPILER (Free Pascal)..."
      fpc -o"$BASENAME" "$FILE" 2>&1
      if [ $? -eq 0 ]; then
        echo "âœ… PASCAL COMPILATION SUCCESSFUL"
        echo "ğŸ‘» Ancient Spirit Rebound to Binary: $(basename $BASENAME)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 0
      else
        echo "âŒ PASCAL COMPILATION FAILED"
        echo "ğŸ› MOTH DETECTED IN PASCAL SOURCE"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 1
      fi
      
    elif [[ "$FILE" == *.bas ]]; then
      echo "ğŸ“¼ LOADING BASIC COMPILER (Node.js Wrapper)..."
      # BASIC uses Node.js wrapper for authentic 1983 semantics
      # No compilation needed - just verify Node.js is available
      if command -v node &> /dev/null; then
        echo "âœ… BASIC VALIDATION SUCCESSFUL"
        echo "ğŸ‘» Ancient Spirit Bound to Node.js Wrapper: $(basename $BASENAME)"
        echo "   (Maintains authentic 1983 BASIC calculation semantics)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 0
      else
        echo "âŒ BASIC VALIDATION FAILED"
        echo "ğŸ› NODE.JS INTERPRETER NOT FOUND"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        exit 1
      fi
    fi
    '
  message: "ğŸ”® Legacy Code Compilation Sequence Initiated"
